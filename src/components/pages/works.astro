---
import FloatBtns from '@hdud/common/components/FloatBtns.astro';
import Layout from '@/layouts/PageLayout.astro';
import WorksGrid from "@/components/works/WorksGrid.astro";
import getWorks from '@/lib/getWorks.ts';
import { getI18n } from "@/i18n/index"
import { getRelativeLocaleUrl } from 'astro:i18n';
import { siteConfig } from '@/site.config';

const { currentLocale } = Astro
const locale = currentLocale ?? 'en'; // fallback to 'en' or your default locale
const i18n = await getI18n(locale, 'design')

const mates = {
  title: i18n('menus.works'),
  description: i18n('mate.description'),
  author: siteConfig.author,
  email: siteConfig.email,
  local: locale,
  ogImage: getRelativeLocaleUrl(locale, '/og-image/site-image.png'),
}
// Ensure getWorks returns an array of works with the correct structure
const worksRaw = await getWorks();
const works = (Array.isArray(worksRaw) ? worksRaw : [worksRaw])
  .filter(item => item.collection === "works" && item.data && typeof item.data.base === "string");
---

<Layout {...mates}>
	<WorksGrid works={works}/>
  <FloatBtns btns={[{
    type: 'theme',
    props: { themes: siteConfig.themes }
  }, {
    type: 'top',
  }]} />
</Layout>
